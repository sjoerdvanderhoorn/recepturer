<!DOCTYPE html>
<html>

<head>
    <title>Recepturer</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="" />
    <meta name="keywords" content="" />
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    <!-- Dependencies -->
    <script src="resources/vuejs/vue.js"></script>
    <link href="resources/googlefonts/materialicons.css" rel="stylesheet">
    <link rel="stylesheet" href="resources/materialize/css/materialize.min.css">
    <script type="application/javascript" src="resources/materialize/js/materialize.min.js"></script>
    <!-- Recepturer -->
    <link rel="stylesheet" href="css/style.css" />
    <script type="application/javascript" src="js/recepturer.js"></script>
    <script type="application/javascript" src="components/recipes.js"></script>
    <script type="application/javascript" src="components/recipe.js"></script>
    <script type="application/javascript" src="components/mealplan.js"></script>
    <script type="application/javascript" src="components/shoppinglist.js"></script>
    <script type="application/javascript" src="components/administration.js"></script>
    <script type="application/javascript" src="components/debug.js"></script>
</head>

<body>
    <div id="recepturer" v-if="settings.temperature.length > 0">

        <!-- App -->
        <header v-cloak>
            <a data-target="nav-mobile" class="top-nav sidenav-trigger btn-floating btn-large teal lighten-3 waves-effect waves-light hide-on-large-only" style="margin: 15px;">
                <i class="material-icons">menu</i>
            </a>
            <ul id="nav-mobile" class="sidenav sidenav-fixed">
                <li class="center-align" style="padding-top: 20px;">
                    <img src="resources/faviconio-logo/r.svg" />
                    <img src="resources/faviconio-logo/recepturer.svg" width="80%" />
                </li>
                <li>
                    <div class="divider"></div>
                </li>
                <li class="bold sidenav-close" :class="{active: page=='recipes' || page=='recipe'}">
                    <a :href="'#/recipes/'" class="waves-effect waves-teal"><i class="material-icons">blender</i>Recipes <span class="new badge" data-badge-caption="">{{this.recipes.length}}</span></a>
                </li>
                <li class="bold sidenav-close" :class="{active: page=='mealplan'}">
                    <a :href="'#/mealplan/'" class="waves-effect waves-teal"><i class="material-icons">menu_book</i>Meal plan <span class="new badge" data-badge-caption="meals" v-if="this.mealplan.length > 0">{{this.mealplan.length}}</span></a>
                </li>
                <li class="bold sidenav-close" :class="{active: page=='shoppinglist'}">
                    <a :href="'#/shoppinglist/'" class="waves-effect waves-teal"><i class="material-icons">shopping_cart</i>Shopping list</a>
                </li>
                <li>
                    <div class="divider"></div>
                </li>
                <li class="bold sidenav-close" :class="{active: page=='administration'}">
                    <a :href="'#/administration/'" class="waves-effect waves-teal"><i class="material-icons">tune</i>Administration</a>
                </li>
                <li v-if="isDebug()">
                    <div class="divider"></div>
                </li>
                <li v-if="isDebug()">
                    <a class="subheader">Development</a>
                </li>
                <li class="bold sidenav-close" :class="{active: page=='debug'}" v-if="isDebug()">
                    <a :href="'#/debug'" class="waves-effect waves-teal"><i class="material-icons">adb</i>Debug</a>
                </li>
            </ul>
        </header>

        <main v-if="page=='recipes'">
            <recipes :recipes="recipes" />
        </main>

        <main v-if="page=='recipe'">
            <recipe :recipe="recipe" />
        </main>

        <main v-if="page=='mealplan'">
            <mealplan :mealplan="mealplan" />
        </main>

        <main v-if="page=='shoppinglist'">
            <shoppinglist :mealplan="mealplan" :shoppinglist="shoppinglist" :categories="categories" />
        </main>

        <main v-if="page=='administration'">
            <administration :settings="settings" />
        </main>

        <main v-if="page=='debug'">
            <debug :recipes="recipes" />
        </main>

    </div>


    <script type="application/javascript">
        var rcp;

        // DOM bindings
        var recepturer = new Vue({
            el: "#recepturer",
            data: {
                page: null,
                "recipe": {
                    "id": "",
                    "title": "",
                    "description": "",
                    "directions": ""
                },
                recipes: [],
                mealplan: [],
                shoppinglist: [],
                categories: [],
                settings: {
                    unitofmeasure: [],
                    temperature: [],
                    time: []
                }
            },
            mounted() {
                this.load();
            },
            created: function() {
                rcp = new Recepturer();
                rcp.settings(this.settings);
            },
            methods: {
                load: function() {
                    fetch("example/new.json")
                        .then(function(response) {
                            return response.json();
                        }).then(function(data) {
                            recepturer.recipes = data.recipes;
                            recepturer.mealplan = data.mealplan;
                            recepturer.shoppinglist = data.shoppinglist;
                            recepturer.categories = data.categories;
                            recepturer.settings = data.settings;
                            router();
                        });
                },
                isDebug: function() {
                    return true;
                },
                isOnMealplan: function(recipe) {
                    return this.$root.mealplan.some(r => r.id == recipe.id);
                },
                addToMealPlan: function(recipe, people) {
                    recipe.people = people;
                    this.$root.mealplan.push(recipe);
                },
                removeFromMealPlan: function(recipe) {
                    var i = this.$root.mealplan.findIndex(r => r.id == recipe.id);
                    if (i > -1) {
                        this.$delete(this.$root.mealplan, i);
                    }
                }
            }
        });

        //recepturer.load();

        function router() {
            var url = document.location.hash.split("/");
            document.title = `Recepturer`;
            switch (url[1]) {
                case "recipes":
                    recepturer.page = url[1];
                    document.title = `Recepturer - Recipes`;
                    break;
                case "recipe":
                    recepturer.page = url[1];
                    recepturer.recipe = recepturer.recipes.find(recipe => recipe.id == url[2]);
                    if (recepturer.recipe) {
                        document.title = `Recepturer - ${recepturer.recipe.title || "New recipe"}`;
                    } else {
                        document.title = `Recepturer - Recipes`;
                    }
                    break;
                case "mealplan":
                    recepturer.page = url[1];
                    document.title = `Recepturer - Meal plan`;
                    break;
                case "shoppinglist":
                    recepturer.page = url[1];
                    document.title = `Recepturer - Shopping list`;
                    break;
                case "administration":
                    recepturer.page = "administration";
                    break;
                case "debug":
                    recepturer.page = "debug";
                    break;
                default:
                    // Unknown link, do nothing
                    recepturer.page = "start";
                    document.title = `Recepturer`;
                    break;
            }
            window.setTimeout(function() {
                M.AutoInit();
            }, 50)
        }
        window.addEventListener("hashchange", router);
        router();
    </script>

    <!-- Dependencies -->
    <script type="application/javascript">
        M.AutoInit();
    </script>

</body>

</html>